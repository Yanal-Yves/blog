<!doctype html><html lang=fr-fr dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Principe de fonctionnement# Standardisé en 2006 (RFC 4408), mis à jour en 2014 (RFC 7208).
Le SPF agit comme un annuaire de confiance. Le propriétaire du domaine a.com publie dans son DNS (enregistrement TXT) la liste des IPs autorisées à envoyer des e-mails en son nom.
Lorsqu’un e-mail arrive, le serveur de réception vérifie l’IP d’envoi par rapport à cette liste. Attention : Le SPF vérifie le domaine indiqué dans le Return-Path (l’enveloppe), et non le From (l’en-tête visible).
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://yanal.fargialla.com/antispoofing-e-mail/04-spf-sender-policy-framework/"><meta property="og:site_name" content="Notes Techniques"><meta property="og:title" content="SPF (Sender Policy Framework) - 4/9"><meta property="og:description" content="Principe de fonctionnement# Standardisé en 2006 (RFC 4408), mis à jour en 2014 (RFC 7208).
Le SPF agit comme un annuaire de confiance. Le propriétaire du domaine a.com publie dans son DNS (enregistrement TXT) la liste des IPs autorisées à envoyer des e-mails en son nom.
Lorsqu’un e-mail arrive, le serveur de réception vérifie l’IP d’envoi par rapport à cette liste. Attention : Le SPF vérifie le domaine indiqué dans le Return-Path (l’enveloppe), et non le From (l’en-tête visible)."><meta property="og:locale" content="fr_fr"><meta property="og:type" content="article"><meta property="article:section" content="antispoofing-e-mail"><meta property="article:modified_time" content="2025-12-24T11:06:49+01:00"><meta itemprop=name content="SPF (Sender Policy Framework) - 4/9"><meta itemprop=description content="Principe de fonctionnement# Standardisé en 2006 (RFC 4408), mis à jour en 2014 (RFC 7208).
Le SPF agit comme un annuaire de confiance. Le propriétaire du domaine a.com publie dans son DNS (enregistrement TXT) la liste des IPs autorisées à envoyer des e-mails en son nom.
Lorsqu’un e-mail arrive, le serveur de réception vérifie l’IP d’envoi par rapport à cette liste. Attention : Le SPF vérifie le domaine indiqué dans le Return-Path (l’enveloppe), et non le From (l’en-tête visible)."><meta itemprop=dateModified content="2025-12-24T11:06:49+01:00"><meta itemprop=wordCount content="1261"><title>SPF (Sender Policy Framework) - 4/9 | Notes Techniques</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://yanal.fargialla.com/antispoofing-e-mail/04-spf-sender-policy-framework/><link rel=stylesheet href=/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG+T2l66Bw7pV8=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/fr.search.min.ba15c7a9a24b4c84693e0d92090b6f662690a6c06603baa976800effef65cccf.js integrity="sha256-uhXHqaJLTIRpPg2SCQtvZiaQpsBmA7qpdoAO/+9lzM8=" crossorigin=anonymous></script><style>.mermaid{background-color:#fff!important;padding:20px;border-radius:8px;margin:20px 0;box-shadow:0 4px 6px rgba(0,0,0,.3);display:flex;justify-content:center}</style></head><body dir=ltr class="book-kind-page book-type-antispoofing-e-mail"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Notes Techniques</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Rechercher aria-label=Rechercher maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-fe14ae1ac3b86a02483d04a7da151f7c class=toggle checked>
<label for=section-fe14ae1ac3b86a02483d04a7da151f7c class=flex><a href=/antispoofing-e-mail/>Antispoofing e-mail</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/antispoofing-e-mail/01-architecture-concepts/>Architecture et concepts - 1/9</a></li><li><a href=/antispoofing-e-mail/02-standard-e-mails/>Les e-mails standards - 2/9</a></li><li><a href=/antispoofing-e-mail/03-fcrdns-validation/>FCrDNS et validation croisée - 3/9</a></li><li><a href=/antispoofing-e-mail/04-spf-sender-policy-framework/ class=active>SPF (Sender Policy Framework) - 4/9</a></li><li><a href=/antispoofing-e-mail/05-dkim-domainkeys-identified-mail/>DKIM (DomainKeys Identified Mail) - 5/9</a></li><li><a href=/antispoofing-e-mail/06-dmarc-domain-based-message-authentication-reporting-and-conformance/>DMARC (Domain-based Message Authentication) - 6/9</a></li><li><a href=/antispoofing-e-mail/07-bimi-brand-indicators-for-message-identification-analyse-des-limites/>BIMI et analyse des limites - 7/9</a></li><li><a href=/antispoofing-e-mail/08-parked-domain-locking/>Parked Domain Locking - 8/9</a></li><li><a href=/antispoofing-e-mail/09-synthese-et-conclusion/>Synthèse et conclusion - 9/9</a></li></ul></li><li><a>Recalboxes</a><ul><li><a href=/recalbox/pc-worms/>PC Worms</a><ul></ul></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/icons/menu.svg class=book-icon alt=Menu></label><h3>SPF (Sender Policy Framework) - 4/9</h3><label for=toc-control><img src=/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#principe-de-fonctionnement>Principe de fonctionnement</a></li><li><a href=#limites>Limites</a><ul><li><a href=#délégation-sophistiquée-des-esp-et-problème-dalignement>Délégation sophistiquée des ESP et problème d&rsquo;alignement</a></li><li><a href=#le-spf-ne-résiste-pas-au-forward-de-mail>Le SPF ne résiste pas au forward d&rsquo;e-mail</a></li><li><a href=#la-contrainte-technique--la-limite-des-10-requêtes-dns>La contrainte technique : La limite des 10 requêtes DNS</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=principe-de-fonctionnement>Principe de fonctionnement<a class=anchor href=#principe-de-fonctionnement>#</a></h2><p>Standardisé en 2006 (<a href=https://www.rfc-editor.org/rfc/rfc4408>RFC 4408</a>), mis à jour en 2014 (<a href=https://www.rfc-editor.org/rfc/rfc7208>RFC 7208</a>).</p><p>Le SPF agit comme un annuaire de confiance. Le propriétaire du domaine <code>a.com</code> publie dans son DNS (enregistrement <code>TXT</code>) la liste des IPs autorisées à envoyer des e-mails en son nom.<br>Lorsqu&rsquo;un e-mail arrive, le serveur de réception vérifie l&rsquo;IP d&rsquo;envoi par rapport à cette liste. Attention : Le SPF vérifie le domaine indiqué dans le <code>Return-Path</code> (l&rsquo;enveloppe), et non le <code>From</code> (l&rsquo;en-tête visible).</p><pre class=mermaid>sequenceDiagram
  autonumber
  %% --- Acteurs ---
  participant Sender as Serveur Expéditeur&lt;br/&gt;(IP: 1.2.3.4)
  participant Receiver as Serveur Destinataire&lt;br/&gt;(b.com)
  participant DNS as DNS&lt;br/&gt;(Zone a.com)
 %% --- Étape 1 : Le transport ---
  Note over Sender, Receiver: 1. L&#39;ENVELOPPE (SMTP)
  Sender-&gt;&gt;Receiver: Connexion TCP (Source IP: 1.2.3.4)
  Sender-&gt;&gt;Receiver: EHLO mail.serveur.com
  Sender-&gt;&gt;Receiver: MAIL FROM: &lt;alice@a.com&gt;
  
  %% --- Le déclencheur ---
  Note right of Receiver: Le serveur B note deux choses :&lt;br/&gt;1. L&#39;IP qui frappe à la porte : 1.2.3.4&lt;br/&gt;2. Le domaine prétendu : a.com
 %% --- Étape 2 : La consultation ---
  Note over Receiver, DNS: 2. L&#39;INTERROGATION (Lookup)
  Receiver-&gt;&gt;DNS: Donne-moi l&#39;enregistrement TXT (SPF) de &#34;a.com&#34;
  DNS--&gt;&gt;Receiver: &#34;v=spf1 ip4:1.2.3.4 ip4:203.0.113.5 -all&#34;
 %% --- Étape 3 : La décision ---
  Note over Receiver: 3. LA COMPARAISON
  Note right of Receiver: Le serveur B regarde sa liste :&lt;br/&gt;&#34;L&#39;IP 1.2.3.4 est-elle dans la liste que le DNS m&#39;a donnée ?&#34;
 alt L&#39;IP est dans la liste
    Receiver-&gt;&gt;Sender: SPF Result: PASS&lt;br/&gt;(Continue la transaction...)
  else L&#39;IP n&#39;est pas dans la liste
    Receiver--&gt;&gt;Sender: SPF Result: FAIL&lt;br/&gt;(550 Message rejected)
end</pre><script src=/mermaid.min.js></script><script>mermaid.initialize({flowchart:{useMaxWidth:!0},theme:"default"})</script><h2 id=limites>Limites<a class=anchor href=#limites>#</a></h2><p>Le SPF présente deux faiblesses majeures :</p><ol><li><strong>Délégation sophistiquée des ESP et problème d&rsquo;alignement</strong> : Si <code>a.com</code> utilise un ESP comme Mailjet, l&rsquo;e-mail aura un <code>Return-Path</code> chez <code>mailjet.com</code> (pour gérer les rebonds) et un <code>From</code> chez <code>a.com</code>. Le SPF validera l&rsquo;IP de Mailjet pour le domaine <code>mailjet.com</code>. Le SPF passe, mais il ne valide pas que l&rsquo;expéditeur visible (<code>a.com</code>) est légitime, ce qui laisse parfois place à une falsification visuelle pour l&rsquo;utilisateur. Nous verrons plus tard que DMARC vient pallier ce problème.</li><li><strong>Le Forwarding</strong> : Si un e-mail est transféré automatiquement d&rsquo;une boîte A vers une boîte B, l&rsquo;IP d&rsquo;envoi change (c&rsquo;est celle du serveur de transfert), mais le <code>Return-Path</code> reste souvent celui de l&rsquo;expéditeur original. L&rsquo;IP du serveur de transfert n&rsquo;étant pas dans la liste SPF de l&rsquo;expéditeur, le SPF échoue (sauf mécanisme de réécriture spécifique comme le SRS).</li><li><strong>L&rsquo;intégrité de message</strong> : Si SPF permet de vérifier qu&rsquo;un mail a été légitimement émis par <code>a.com</code>, il ne permet pas de valider que le message n&rsquo;a pas été modifié lors de son transfert. Il faudra s&rsquo;appuyer sur DKIM pour confirmer que le message n&rsquo;a pas été altéré comme nous le verrons plus tard.</li><li><strong>La contrainte technique : La limite des 10 requêtes DNS :</strong> Pour éviter que la vérification SPF ne serve de vecteur d&rsquo;attaque par déni de service (DoS) sur les infrastructures DNS, l&rsquo;évaluation d&rsquo;un enregistrement SPF ne doit pas générer plus de 10 requêtes DNS supplémentaires.</li></ol><h3 id=délégation-sophistiquée-des-esp-et-problème-dalignement>Délégation sophistiquée des ESP et problème d&rsquo;alignement<a class=anchor href=#d%c3%a9l%c3%a9gation-sophistiqu%c3%a9e-des-esp-et-probl%c3%a8me-dalignement>#</a></h3><p>Le problème se pose lorsque le propriétaire d&rsquo;un domaine (<code>a.com</code>) délègue l&rsquo;envoi de ses e-mails à un Fournisseur de Services de Messagerie (ESP) comme Mailjet.</p><h4 id=le-mécanisme-classique-du-spf>Le Mécanisme Classique du SPF<a class=anchor href=#le-m%c3%a9canisme-classique-du-spf>#</a></h4><p>Le SPF fonctionne en vérifiant si l&rsquo;adresse IP d&rsquo;envoi est autorisée par le domaine du <code>Return-Path</code> (le domaine de l&rsquo;enveloppe) :</p><ul><li>Expéditeur : <code>alice@a.com</code></li><li>Adresse IP : L&rsquo;IP appartient à Mailjet.</li><li><code>Return-Path</code> : Dans une configuration standard, l&rsquo;ESP utilise son propre domaine pour gérer les rebonds (ex : <code>bounce-id@mailjet.com</code>).</li></ul><p>Le serveur récepteur (<code>b.com</code>) effectue la vérification SPF :</p><ul><li>Il regarde le <code>Return-Path</code> : <code>mailjet.com</code>.</li><li>Il consulte le record SPF de <code>mailjet.com</code>.</li><li>Il constate que l&rsquo;IP est bien dans la liste des IPs autorisées par <code>mailjet.com</code>.</li><li>Résultat SPF : <code>PASS</code>.</li></ul><h4 id=léchec-de-lauthentification-de-lutilisateur-final>L&rsquo;Échec de l&rsquo;Authentification de l&rsquo;Utilisateur Final<a class=anchor href=#l%c3%a9chec-de-lauthentification-de-lutilisateur-final>#</a></h4><p>Le problème est que le SPF a validé la légitimité de Mailjet, mais n&rsquo;a rien prouvé concernant la légitimité de l&rsquo;expéditeur : <code>a.com</code> :</p><ul><li>Le serveur récepteur sait que Mailjet a envoyé l&rsquo;e-mail.</li><li>Le serveur récepteur ne vérifie pas que l&rsquo;utilisateur qui a configuré le <code>From</code> en <code>alice@a.com</code> est effectivement légitime pour émettre un e-mail de <code>a.com</code>.</li></ul><h4 id=le-contournement-du-problème>Le Contournement du Problème<a class=anchor href=#le-contournement-du-probl%c3%a8me>#</a></h4><p>C&rsquo;est là que le SPF seul montre ses limites en matière d&rsquo;anti-usurpation (anti-spoofing) :<br>Une personne mal intentionnée (un spammeur) pourrait :</p><ul><li>Utiliser l&rsquo;infrastructure de Mailjet avec son propre compte ou un compte piraté.</li><li>Régler le champ From à <code>president@whitehouse.gov</code>.</li><li>Le <code>Return-Path</code> restera <code>bounce-id@bnc3.mailjet.com</code>.</li><li>Vérification SPF : L&rsquo;e-mail passe, car l&rsquo;IP est autorisée par le domaine <code>mailjet.com</code>.</li><li>Conclusion : Le SPF seul permet de valider le chemin d&rsquo;envoi (l&rsquo;ESP), mais ne garantit pas que le domaine visible (<code>From</code>) a été utilisé légitimement, car il y a un désalignement entre le domaine du <code>From</code> (<code>whitehouse.gov</code>) et le domaine vérifié par SPF (<code>mailjet.com</code>).<br>Le SPF est donc aveugle à cette délégation sophistiquée : il voit juste que le <code>Return-Path</code> est bien géré.<br>C&rsquo;est précisément pour remédier à ce manque d&rsquo;alignement du domaine visible (<code>From</code>) que le protocole <strong>DMARC</strong> a été créé. DMARC exige que le domaine du <code>Return-Path</code> (vérifié par SPF) soit aligné avec le domaine du <code>From</code> (ou que le domaine de la signature DKIM soit aligné avec le domaine du <code>From</code> comme nous le verrons plus tard).</li></ul><h3 id=le-spf-ne-résiste-pas-au-forward-de-mail>Le SPF ne résiste pas au forward d&rsquo;e-mail<a class=anchor href=#le-spf-ne-r%c3%a9siste-pas-au-forward-de-mail>#</a></h3><p>Le transfert (forward) d&rsquo;e-mail est le talon d&rsquo;Achille du SPF.<br>Imaginons qu&rsquo;Alice (<code>a.com</code>) envoie un e-mail à Bob (<code>b.com</code>).<br>Bob a configuré une redirection automatique de sa boîte pro vers sa boîte perso (<code>c.com</code>).<br>Le serveur de Bob reçoit l&rsquo;e-mail (SPF valide : l&rsquo;IP d&rsquo;Alice est OK).<br>Le serveur de Bob transfère l&rsquo;e-mail vers <code>c.com</code>.<br>Le problème : Du point de vue du serveur <code>c.com</code>, l&rsquo;e-mail provient de l&rsquo;adresse IP du serveur de Bob (<code>b.com</code>), mais l&rsquo;adresse d&rsquo;expéditeur (<code>Return-Path</code>) indique toujours <code>a.com</code>.<br>Le serveur <code>c.com</code> va vérifier le SPF. Deux cas de figure se présentent :
<strong>1. Sans réécriture :</strong> C&rsquo;est le comportement natif du protocole SPF. Le serveur vérifie si l&rsquo;IP de Bob (<code>b.com</code>) est autorisée à envoyer des e-mails pour le domaine d&rsquo;Alice (<code>a.com</code>). La réponse est NON, le SPF échoue.
<strong>2. Avec SRS (Sender Rewriting Scheme) :</strong> Le serveur de Bob réécrit l&rsquo;enveloppe technique pour que le SPF passe. Cependant, cela change le domaine vérifié (qui devient b.com) et brise l&rsquo;alignement avec le domaine visible (a.com). On dit que l&rsquo;<strong>alignement SPF échoue</strong>. Ce désalignement peut être un problème pour valider l&rsquo;authenticité d&rsquo;un e-mail que nous aborderons dans la section consacrée à <a href=06-dmarc-domain-based-message-authentication-reporting-and-conformance.md>DMARC</a>.</p><p>Le SRS a été inventé pour empêcher que les mails légitimes ne soient rejetés (bounce) lors d&rsquo;un transfert. La plupart des gros hébergeurs (OVH, Gmail, Outlook) appliquent le SRS. Il &ldquo;répare&rdquo; la couche transport (SMTP) au détriment de l&rsquo;alignement SPF.</p><h3 id=la-contrainte-technique--la-limite-des-10-requêtes-dns>La contrainte technique : La limite des 10 requêtes DNS<a class=anchor href=#la-contrainte-technique--la-limite-des-10-requ%c3%aates-dns>#</a></h3><p>Pour éviter que la vérification SPF ne serve de vecteur d&rsquo;attaque par déni de service (DoS) sur les infrastructures DNS, la <a href=https://datatracker.ietf.org/doc/html/rfc7208#section-4.6.4>RFC 7208 impose une limite stricte : l&rsquo;évaluation d&rsquo;un enregistrement SPF ne doit pas générer plus de 10 requêtes DNS supplémentaires.</a></p><p>Chaque mécanisme qui demande au serveur de réception d&rsquo;interroger le DNS compte pour 1 : cela concerne les <code>include</code>, <code>a</code>, <code>mx</code>, <code>ptr</code> et <code>exists</code>. Attention, cela est récursif : si vous faites un <code>include:spf.protection.outlook.com</code> et que Microsoft fait lui-même un <code>include</code> dans son record, cela compte pour 2 requêtes. En revanche, les mécanismes <code>ip4</code> et <code>ip6</code> sont &ldquo;gratuits&rdquo; car ils ne nécessitent pas d&rsquo;interrogation DNS.</p><p><strong>Le danger :</strong> Si vous cumulez trop de prestataires (ex: Google + Salesforce + Mailjet + Zendesk), vous dépasserez cette limite. Le résultat sera un <code>PermError</code> immédiat, provoquant le rejet de vos e-mails ou leur classement en spam, même si l&rsquo;IP expéditrice était techniquement autorisée.</p></article><hr class=book-spacer style="margin-top:3rem;border-top:1px solid var(--gray-200)"><div class=article-footer style=font-size:.9rem;color:var(--body-font-color)><p><strong>Auteur :</strong> Yanal-Yves FARGIALLA<br><strong>Dernière mise à jour :</strong> 24 décembre 2025</p><div style="display:flex;align-items:center;gap:10px;margin:1rem 0"><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/ target=_blank><img alt="Licence Creative Commons" style=border-width:0 src=https://i.creativecommons.org/l/by-sa/4.0/88x31.png>
</a><span>Cet article est mis à disposition selon les termes de la <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/ target=_blank>Licence Creative Commons Attribution - Partage dans les Mêmes Conditions 4.0 International</a>.</span></div><div style="background-color:rgba(255,255,0,.1);padding:10px;border-left:4px solid #f6e05e;margin-top:1rem"><em><strong>Note de transparence :</strong> Cet article a été rédigé avec l'assistance de l'intelligence artificielle (Google Gemini) pour la structuration et la synthèse technique, puis vérifié et validé par l'auteur.</em></div></div><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/antispoofing-e-mail/03-fcrdns-validation/ class="flex align-center"><img src=/icons/backward.svg class=book-icon alt=Backward>
<span>FCrDNS et validation croisée - 3/9</span>
</a></span><span><a href=/antispoofing-e-mail/05-dkim-domainkeys-identified-mail/ class="flex align-center"><span>DKIM (DomainKeys Identified Mail) - 5/9</span>
<img src=/icons/forward.svg class=book-icon alt=Forward></a></span></div><div class=book-comments></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#principe-de-fonctionnement>Principe de fonctionnement</a></li><li><a href=#limites>Limites</a><ul><li><a href=#délégation-sophistiquée-des-esp-et-problème-dalignement>Délégation sophistiquée des ESP et problème d&rsquo;alignement</a></li><li><a href=#le-spf-ne-résiste-pas-au-forward-de-mail>Le SPF ne résiste pas au forward d&rsquo;e-mail</a></li><li><a href=#la-contrainte-technique--la-limite-des-10-requêtes-dns>La contrainte technique : La limite des 10 requêtes DNS</a></li></ul></li></ul></nav></div></aside></main></body></html>