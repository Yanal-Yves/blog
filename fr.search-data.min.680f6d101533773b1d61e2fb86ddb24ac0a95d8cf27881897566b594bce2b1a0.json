[{"id":0,"href":"/antispoofing-e-mail/","title":"Antispoofing e-mail","section":"Accueil","content":"Cette s√©rie d\u0026rsquo;articles s\u0026rsquo;adresse aux administrateurs de domaines qui ont besoin de configurer des bo√Ætes e-mail de fa√ßon √† emp√™cher l\u0026rsquo;usurpation d\u0026rsquo;identit√©.\n"},{"id":1,"href":"/antispoofing-e-mail/01-architecture-concepts/","title":"De SMTP √† DMARC (1/8) : Architecture et concepts","section":"Antispoofing e-mail","content":"Introduction# Objectif et audience# Il y a trois types d\u0026rsquo;utilisateurs du syst√®me d\u0026rsquo;e-mail :\nLes utilisateurs des bo√Ætes e-mail Les administrateurs des domaines Les mainteneurs de l\u0026rsquo;infrastructure e-mail Cette s√©rie d\u0026rsquo;articles s\u0026rsquo;adresse aux administrateurs de domaines qui ont besoin de configurer des bo√Ætes e-mail de fa√ßon √† emp√™cher l\u0026rsquo;usurpation d\u0026rsquo;identit√©.\nPr√©requis# Pour tirer pleinement profit de cet article et s√©curiser votre domaine, vous devez :\nAcc√®s et Environnement Avoir un acc√®s administrateur √† la zone DNS de votre domaine (chez votre registrar ou h√©bergeur). Disposer d\u0026rsquo;un terminal (Linux/macOS) pour effectuer des requ√™tes DNS. Connaissances Techniques Compr√©hension du DNS : Savoir modifier une zone DNS. Conna√Ætre les types d\u0026rsquo;enregistrements : A, AAAA, TXT, CNAME, MX et PTR. Comprendre les notions de TTL (Time To Live) et de propagation DNS (d√©lais de mise √† jour). R√©seau (IP) : Diff√©rencier IPv4 et IPv6. Comprendre la notation CIDR (ex: 192.51.100.0/24) utilis√©e fr√©quemment dans les r√®gles SPF pour autoriser des plages d\u0026rsquo;adresses enti√®res. Avoir une notion basique de la cryptographie asym√©trique (cl√© priv√©e / cl√© publique), utile pour comprendre le fonctionnement de la signature DKIM. Concepts sp√©cifiques au mail# Tout au long de cette s√©rie d\u0026rsquo;articles, on consid√®re un e-mail partant du domaine a.com (domaine exp√©diteur) √† destination du domaine b.com (domaine de r√©ception). Ex : alice@a.com vers bob@b.com.\nDans l\u0026rsquo;article, on parle d\u0026rsquo;ESP. Un ESP (pour Email Service Provider, ou Fournisseur de Services de Messagerie en fran√ßais) est une entreprise ou une plateforme qui fournit des services pour aider les particuliers ou, plus couramment, les entreprises √† g√©rer et envoyer des campagnes d\u0026rsquo;e-mails en masse (e-mail marketing, newsletters, etc.) ou des e-mails transactionnels.\nUn e-mail transactionnel (ou e-mail de service/syst√®me) est un message automatis√© et non promotionnel qui est envoy√© √† un utilisateur suite √† une action sp√©cifique que cet utilisateur a initi√©e sur un site web ou dans une application (ex : le mail qu\u0026rsquo;on re√ßoit quand on clique sur \u0026ldquo;mot de passe oubli√©\u0026rdquo;).\nLe protocole d\u0026rsquo;envoi de mails : SMTP# Le SMTP (Simple Mail Transfer Protocol) est le protocole standard utilis√© pour envoyer et transf√©rer le courrier √©lectronique sur internet. Ce protocole sert uniquement √† exp√©dier (\u0026ldquo;push\u0026rdquo;) le message de votre ordinateur vers le serveur, puis de serveur en serveur. Il ne sert pas √† r√©cup√©rer vos e-mails pour les lire. Pour cela, on utilise d\u0026rsquo;autres protocoles (comme IMAP ou POP) qui agissent comme la cl√© pour ouvrir votre bo√Æte aux lettres et lire le courrier arriv√©.\nHistoriquement d√©fini par la RFC 821 (1982) puis mis √† jour par la RFC 5321 (2008), le protocole SMTP a √©t√© con√ßu √† une √©poque o√π Internet √©tait un r√©seau de confiance. La s√©curit√© n\u0026rsquo;√©tait pas la priorit√©.\nLe diagramme suivant montre les diff√©rentes RFC qui ont fa√ßonn√© le protocole SMTP :\ngraph TD %% --- D√©finition des Styles --- classDef base fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000; classDef esmtp fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000; classDef merge fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#000; classDef current fill:#c8e6c9,stroke:#1b5e20,stroke-width:4px,color:#000; %% --- 1982 : L\u0026#39;origine --- R821(\u0026#34;\u0026lt;b\u0026gt;RFC 821\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Ao√ªt 1982\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Fondation de SMTP.\u0026#34;):::base %% --- La branche ESMTP (Ann√©es 90) --- R1425(\u0026#34;\u0026lt;b\u0026gt;RFC 1425\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;F√©v 1993\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Invention ESMTP (EHLO).\u0026#34;):::esmtp R1651(\u0026#34;\u0026lt;b\u0026gt;RFC 1651\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Juil 1994\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Correctifs ESMTP.\u0026#34;):::esmtp R1869(\u0026#34;\u0026lt;b\u0026gt;RFC 1869\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Nov 1995\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Standard ESMTP Stable.\u0026#34;):::esmtp %% --- La Fusion (Ann√©es 2000) --- R2821(\u0026#34;\u0026lt;b\u0026gt;RFC 2821\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Avril 2001\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Fusion SMTP + ESMTP.\u0026#34;):::merge R5321(\u0026#34;\u0026lt;b\u0026gt;RFC 5321\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Oct 2008\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Standard Actuel.\u0026#34;):::current %% --- Relations Chronologiques (Verticales) --- %% Astuce : Lien invisible pour forcer 821 au-dessus de 1425 R821 ~~~ R1425 %% √âvolution de la branche ESMTP R1425 --\u0026gt;|Remplace| R1651 R1651 --\u0026gt;|Remplace| R1869 %% La Fusion des deux branches R821 --\u0026gt;|Int√©gr√©e dans| R2821 R1869 --\u0026gt;|Int√©gr√©e dans| R2821 %% Le Standard Final R2821 --\u0026gt;|Remplac√©e par| R5321Structure d\u0026rsquo;un e-mail# Un e-mail est une cha√Æne de caract√®res format√©e selon des standards sp√©cifiques (principalement la RFC 5322 (2008)), contenant un en-t√™te et un corps de message.\nL\u0026rsquo;en-t√™te contient notamment le Return-Path (l\u0026rsquo;adresse pour les notifications d\u0026rsquo;erreurs/rebonds non visible pour l\u0026rsquo;utilisateur) et le From (l\u0026rsquo;adresse affich√©e √† l\u0026rsquo;utilisateur), mais aussi d\u0026rsquo;autres champs cruciaux comme le To (destinataire affich√©) et le Subject (objet du message affich√© √† l\u0026rsquo;utilisateur), ainsi que des champs techniques invisibles comme le Message-ID et des champs d\u0026rsquo;authentification comme DKIM-Signature que nous verrons plus tard. Le Message-ID est l\u0026rsquo;identifiant mondialement unique d\u0026rsquo;un e-mail et ind√©pendant du serveur qui l\u0026rsquo;h√©berge.\nLe diagramme suivant montre les diff√©rentes RFC qui ont fa√ßonn√© la structure d\u0026rsquo;un e-mail :\ngraph TD %% --- D√©finition des Styles (Identiques au sch√©ma SMTP) --- classDef base fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000; classDef mime fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000; classDef update fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#000; classDef current fill:#c8e6c9,stroke:#1b5e20,stroke-width:4px,color:#000; %% --- 1982 : L\u0026#39;origine --- R822(\u0026#34;\u0026lt;b\u0026gt;RFC 822\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Ao√ªt 1982\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Format Texte Standard.\u0026lt;br/\u0026gt;(ASCII seulement)\u0026#34;):::base %% --- 1996 : La R√©volution Multim√©dia (MIME) --- %% Note: MIME est une extension, pas un remplacement R2045(\u0026#34;\u0026lt;b\u0026gt;RFC 2045\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Nov 1996\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Standards MIME.\u0026lt;br/\u0026gt;(HTML, Pi√®ces jointes...)\u0026#34;):::mime %% --- 2001 : La Modernisation --- R2822(\u0026#34;\u0026lt;b\u0026gt;RFC 2822\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Avril 2001\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Mise √† jour syntaxique.\u0026#34;):::update %% --- 2008 : Le Standard Actuel --- R5322(\u0026#34;\u0026lt;b\u0026gt;RFC 5322\u0026lt;/b\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;i\u0026gt;Oct 2008\u0026lt;/i\u0026gt;\u0026lt;br/\u0026gt;Standard Actuel\u0026lt;br/\u0026gt;(Format du Message).\u0026#34;):::current %% --- Relations Chronologiques --- %% Lign√©e principale (Le format du texte) R822 --\u0026gt;|Remplac√©e par| R2822 R2822 --\u0026gt;|Remplac√©e par| R5322 %% L\u0026#39;apport de MIME (Extension lat√©rale) R822 -.-\u0026gt;|√âtendu par| R2045 R2045 -.-\u0026gt;|Toujours utilis√© avec| R5322Un e-mail peut se d√©composer en trois composants techniques :\nL\u0026rsquo;Enveloppe (The Envelope) - Protocole SMTP# C\u0026rsquo;est la partie utilis√©e par les serveurs pour le transport de l\u0026rsquo;e-mail. Elle n\u0026rsquo;est g√©n√©ralement pas visible par l\u0026rsquo;utilisateur final. Elle est d√©finie par les commandes du protocole SMTP (MAIL FROM: et RCPT TO:). Elle contient :\nL\u0026rsquo;adresse de l\u0026rsquo;exp√©diteur de l\u0026rsquo;enveloppe (MAIL FROM) : C\u0026rsquo;est cette adresse qui est utilis√©e pour le Return-Path dans l\u0026rsquo;en-t√™te (une fois l\u0026rsquo;e-mail re√ßu). Elle est essentielle pour les m√©canismes SPF et la gestion des rebonds. L\u0026rsquo;adresse du destinataire de l\u0026rsquo;enveloppe (RCPT TO) : L\u0026rsquo;adresse r√©elle o√π l\u0026rsquo;e-mail doit √™tre livr√©. L\u0026rsquo;En-t√™te (The Header) - RFC 5322# C\u0026rsquo;est un ensemble de champs structur√©s au d√©but du message.\nIl contient notamment les champs :\nFrom (Adresse de l\u0026rsquo;exp√©diteur affich√©e) Return-Path (qui est rempli avec l\u0026rsquo;adresse MAIL FROM de l\u0026rsquo;enveloppe) To, Cc, Bcc, Subject, Date.\nIl contient √©galement les informations de s√©curit√© ajout√©es par le serveur de r√©ception pour indiquer le r√©sultat des v√©rifications SPF, DKIM et DMARC. Le Corps du Message (The Body)# C\u0026rsquo;est le contenu r√©el de l\u0026rsquo;e-mail, souvent format√© en texte simple (text/plain) et/ou en HTML (text/html).\nIl est structur√© selon le standard MIME (Multipurpose Internet Mail Extensions, RFC 2045), permettant d\u0026rsquo;inclure des pi√®ces jointes et du HTML.\nLe voyage d\u0026rsquo;un e-mail# Pour comprendre le voyage d\u0026rsquo;un e-mail, il est utile de conna√Ætre les acteurs logiciels impliqu√©s.\nMUA (Mail User Agent) - Le Client de Messagerie\nC\u0026rsquo;est l\u0026rsquo;interface utilis√©e par l\u0026rsquo;humain pour lire et √©crire des e-mails.\nExemples : Mozilla Thunderbird, Microsoft Outlook, l\u0026rsquo;application Mail sur iPhone, ou une interface web comme Roundcube ou Gmail (Webmail).\nR√¥le : Il formate le message et l\u0026rsquo;envoie au premier maillon de la cha√Æne (le MSA/MTA) via SMTP. MTA (Mail Transfer Agent) - Le Facteur / Le Serveur de Relais\nC\u0026rsquo;est le logiciel serveur qui transporte l\u0026rsquo;e-mail d\u0026rsquo;une machine √† une autre via le protocole SMTP.\nExemples : Postfix, Sendmail, Microsoft Exchange Server.\nR√¥le : Il re√ßoit le message du MUA, consulte le DNS (MX records) pour savoir o√π l\u0026rsquo;envoyer, et le transmet au MTA du destinataire (ou √† un relais interm√©diaire). C\u0026rsquo;est le MTA qui effectue souvent les contr√¥les SPF. MDA (Mail Delivery Agent) - Le Trieur / Le Livreur Final\nC\u0026rsquo;est le logiciel qui re√ßoit le message final du MTA et le d√©pose dans la bo√Æte aux lettres de l\u0026rsquo;utilisateur sur le serveur.\nExemples : Dovecot, Procmail.\nR√¥le : Il stocke le message sur le disque dur pour qu\u0026rsquo;il puisse √™tre r√©cup√©r√© plus tard par le MUA (via les protocoles IMAP ou POP). C\u0026rsquo;est souvent √† ce stade que les filtres anti-spam (comme SpamAssassin) analysent le contenu final. Le voyage typique :\nMUA (Exp√©diteur) ‚ûî MTA (Serveur d√©part) ‚ûî Internet ‚ûî MTA (Serveur arriv√©e) ‚ûî MDA (Stockage) ‚ûî MUA (Destinataire)\ngraph TD %% --- D√©finition des Styles --- classDef client fill:#f8bbd0,stroke:#c2185b,stroke-width:2px,color:#000; classDef server fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000; classDef storage fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000; classDef internet fill:#f5f5f5,stroke:#9e9e9e,stroke-width:2px,stroke-dasharray: 5 5,color:#000; %% --- Domaine A (Exp√©diteur) --- subgraph \u0026#34;Domaine A (a.com)\u0026#34; Alice(Alice):::client --\u0026gt;|R√©dige| MUA_A[MUA\u0026lt;br/\u0026gt;Thunderbird]:::client MUA_A --\u0026gt;|SMTP\u0026lt;br/\u0026gt;Auth| MTA_A[MTA\u0026lt;br/\u0026gt;Facteur\u0026lt;br/\u0026gt;Postfix]:::server end %% --- Internet --- subgraph \u0026#34;Internet\u0026#34; MTA_A --\u0026gt;|Requ√™te DNS MX?| DNS((DNS)):::internet DNS -.-\u0026gt;|R√©ponse IP| MTA_A MTA_A --\u0026gt;|SMTP\u0026lt;br/\u0026gt;Transmission| MTA_B[MTA\u0026lt;br/\u0026gt;Facteur\u0026lt;br/\u0026gt;Postfix]:::server end %% --- Domaine B (Destinataire) --- subgraph \u0026#34;Domaine B (b.com)\u0026#34; MTA_B --\u0026gt;|Livraison| MDA_B[(\u0026#34;MDA\u0026lt;br/\u0026gt;Trieur\u0026lt;br/\u0026gt;Dovecot/Imap\u0026#34;)]:::storage MDA_B -.-\u0026gt;|IMAP / POP\u0026lt;br/\u0026gt;R√©cup√©ration| MUA_B[MUA\u0026lt;br/\u0026gt;Webmail]:::client MUA_B --\u0026gt;|Lit| Bob(Bob):::client endL\u0026rsquo;analogie postale# Bien que les images aient leurs limites, elles permettent de garder de la hauteur sans se perdre dans les d√©tails techniques. Voici les protocoles de s√©curit√© que nous allons voir et leurs images respectives :\nSMTP est le facteur et le camion de livraison : Il prend votre lettre (e-mail) depuis votre bo√Æte aux lettres de d√©part et la transporte jusqu\u0026rsquo;au bureau de poste du destinataire. FCrDNS valide le camion qui transporte l\u0026rsquo;enveloppe. C\u0026rsquo;est la v√©rification que la plaque d\u0026rsquo;immatriculation (IP) correspond bien √† la carte grise du camion (Nom de domaine du serveur). On s\u0026rsquo;assure que le camion n\u0026rsquo;est pas vol√©. Si le FCrDNS valide le camion, le SPF valide l\u0026rsquo;enveloppe et l\u0026rsquo;adresse de l\u0026rsquo;exp√©diteur (le Return-Path). L\u0026rsquo;entreprise √©mettrice du message (le Domaine a.com) a publi√© une liste. Si le camion qui arrive chez b.com ne figure pas sur la liste, on refuse l\u0026rsquo;enveloppe. DKIM est un genre de sceau de cire num√©rique de l\u0026rsquo;enveloppe. Attention cependant, DKIM ne permet pas de garantir que le message n\u0026rsquo;a pas √©t√© lu, juste qu\u0026rsquo;il n\u0026rsquo;a pas √©t√© modifi√©. Une autre image est le scell√© de preuves de la police car tout le monde peut voir ce qu\u0026rsquo;il y a dedans, mais personne ne peut le modifier sans laisser de traces. La limite √©vidente de cette image est que l\u0026rsquo;on n\u0026rsquo;envoie pas nos lettres dans des scell√©s en plastique de la police ! DMARC v√©rifie la coh√©rence entre le message et l\u0026rsquo;enveloppe : Il ouvre l\u0026rsquo;enveloppe. Il regarde l\u0026rsquo;en-t√™te du papier √† lettre (le From: que le destinataire va lire). Il compare cet en-t√™te avec les preuves ext√©rieures : soit avec l\u0026rsquo;adresse au dos de l\u0026rsquo;enveloppe (Return-Path valid√© par le SPF), soit avec le logo sur le sceau de cire (Signature DKIM). "},{"id":2,"href":"/antispoofing-e-mail/02-fcrdns-validation/","title":"De SMTP √† DMARC (2/8) : FCrDNS et validation crois√©e","section":"Antispoofing e-mail","content":"Principe de fonctionnement# Cette technique est apparue comme une bonne pratique dans les ann√©es 90.\nLe principe de s√©curit√© : La robustesse de cette technique repose sur la n√©cessit√© de contr√¥ler √† la fois l\u0026rsquo;infrastructure IP (C√¥t√© H√©bergeur) et la zone DNS (C√¥t√© Domaine). Un usurpateur ne poss√©dant que l\u0026rsquo;un des deux acc√®s ne pourra pas valider le test.\nRappels :\nLe FQDN (Fully Qualified Domain Name) est l\u0026rsquo;adresse compl√®te et absolue d\u0026rsquo;une machine sur Internet (ex : mail.a.com). Le FQDN est configur√© dans la zone DNS (ex : a.com) qui est g√©r√© par le propri√©taire du domaine. Le rDNS est le processus inverse qui permet de trouver le nom de domaine associ√© √† une adresse IP. L\u0026rsquo;enregistrement s\u0026rsquo;appelle un PTR (Pointer Record). Il est stock√© dans la zone in-addr.arpa (IPv4) ou ip6.arpa (IPv6). Les zones rDNS in-addr.arpa pour IPv4 et ip6.arpa sont g√©r√©es par d√©l√©gation par les fournisseurs d\u0026rsquo;adresse IP (H√©bergeurs, FAI). Phase 1 : La connexion et l\u0026rsquo;annonce# Connexion : Le serveur de mail de a.com se connecte au serveur de mail de b.com. Annonce (HELO/EHLO) : Il se pr√©sente : EHLO pf-1010.whm.fr-par.scw.cloud R√©cup√©ration IP : Le serveur de b.com accepte la connexion. Il voit physiquement d\u0026rsquo;o√π viennent les paquets de donn√©es.\nIl note l\u0026rsquo;IP appelante : 51.159.128.187. Phase 2 : Requ√™te Inverse (Le \u0026ldquo;Reverse\u0026rdquo;)# Recherche PTR : Le serveur b.com interroge le DNS (zone in-addr.arpa car c\u0026rsquo;est une IPv4) :\n\u0026ldquo;Quel est le nom associ√© √† l\u0026rsquo;IP 51.159.128.187 ?\u0026rdquo; (Requ√™te PTR)\nR√©ponse Inverse : Le DNS r√©pond :\n\u0026ldquo;Cette IP appartient au nom de machine pf-1010.whm.fr-par.scw.cloud.\u0026rdquo;\n(Premier bon point : le nom trouv√© correspond au nom annonc√© dans le EHLO √† l\u0026rsquo;√©tape 2. Mais ce n\u0026rsquo;est pas suffisant, le DNS a pu √™tre manipul√©). Phase 3 : V√©rification de non-g√©n√©ricit√© (Generic PTR Check)# Le serveur de b.com v√©rifie que le nom d\u0026rsquo;h√¥te ne ressemble pas √† une IP r√©sidentielle dynamique.\nCette v√©rification, qui est une r√®gle suppl√©mentaire de qualit√©, est appel√©e Generic PTR Check et ne fait pas stricto sensu partie de la v√©rification FCrDNS.\nex : Cas d\u0026rsquo;un nom d\u0026rsquo;h√¥te personnalis√©\n$ host 51.159.128.187 *187.128.159.51.in-addr.arpa domain name pointer pf-1010.whm.fr-par.scw.cloud.ex : Cas d\u0026rsquo;un nom d\u0026rsquo;h√¥te g√©n√©rique\n$ host 82.65.37.251 251.37.65.82.in-addr.arpa domain name pointer 82-65-37-251.subs.proxad.net.Les indices suspects (Expressions r√©guli√®res (Regex)) :\nPr√©sence de l\u0026rsquo;IP dans le nom. Mots-cl√©s r√©sidentiels : dynamic, dsl, fiber, pool, dhcp, cable, dialup, etc.. Manque de domaine personnalis√© : Finir par le domaine du FAI (orange.fr, free.fr) au lieu d\u0026rsquo;un domaine personnalis√©. Phase 4 : Requ√™te Directe (Le \u0026ldquo;Forward\u0026rdquo;)# La m√©thode FCrDNS (Forward-confirmed reverse DNS) ferme la boucle de v√©rification.\nRequ√™te Directe (Le \u0026ldquo;Forward\u0026rdquo;) : Le serveur b.com prend le nom trouv√© dans le PTR et interroge le DNS classique :\n\u0026ldquo;Quelle est l\u0026rsquo;adresse IP officielle de pf-1010.whm.fr-par.scw.cloud ?\u0026rdquo; (Requ√™te A) R√©ponse Directe : Le DNS de Scaleway (scw.cloud) r√©pond :\n\u0026ldquo;L\u0026rsquo;IP de cette machine est 51.159.128.187.\u0026rdquo; Comparaison Finale : Le serveur de b.com compare l\u0026rsquo;IP qu\u0026rsquo;il a sous les yeux (Phase 1 - √©tape 3) avec l\u0026rsquo;IP officielle que le DNS vient de lui donner (Phase 4 - √©tape 2).\n51.159.128.187 (IP r√©elle) == 51.159.128.187 (IP DNS)\nR√©sultat : Cette machine est bien celle qu\u0026rsquo;elle pr√©tend √™tre. L\u0026rsquo;infrastructure est coh√©rente. Si les deux correspondent, cela garantit que l\u0026rsquo;entr√©e PTR n\u0026rsquo;est pas falsifi√©e et que le propri√©taire du domaine a explicitement autoris√© cette IP √† utiliser ce nom. Phase 5 : Le contr√¥le de coh√©rence \u0026ldquo;HELO\u0026rdquo;# En plus de la v√©rification de l\u0026rsquo;IP, les serveurs modernes effectuent une v√©rification sur le nom annonc√© par le serveur lors de sa pr√©sentation (la commande EHLO mon.serveur.com). Si le FCrDNS valide que l\u0026rsquo;IP 1.2.3.4 correspond bien au nom mail.a.com, mais que le serveur se pr√©sente en disant EHLO je.suis.google.com, le serveur de r√©ception d√©tectera cette incoh√©rence. Bien que techniquement distinct du FCrDNS, ce test (souvent appel√© HELO check) compl√®te la validation de l\u0026rsquo;infrastructure : le serveur doit avoir une IP valide, un nom DNS valide, et s\u0026rsquo;annoncer avec ce m√™me nom.\nSynth√®se# sequenceDiagram autonumber participant Sender as Serveur A (Exp√©diteur) participant Receiver as Serveur B (Destinataire) participant DNS as Serveur DNS Note over Sender, Receiver: 1. Connexion \u0026amp; Annonce Sender-\u0026gt;\u0026gt;Receiver: TCP Connect (IP: 1.2.3.4) Sender-\u0026gt;\u0026gt;Receiver: EHLO mail.a.com Note right of Receiver: Le serveur B note :\u0026lt;br/\u0026gt;IP = 1.2.3.4\u0026lt;br/\u0026gt;Nom annonc√© = mail.a.com Note over Receiver, DNS: 2. V√©rification Inverse (rDNS/PTR) Receiver-\u0026gt;\u0026gt;DNS: \u0026#34;Qui est l\u0026#39;IP 1.2.3.4 ?\u0026#34; (Query PTR) DNS--\u0026gt;\u0026gt;Receiver: \u0026#34;C\u0026#39;est mail.a.com\u0026#34; Note over Receiver: Check 1 : L\u0026#39;IP a un nom (PTR existe).\u0026lt;br/\u0026gt;Check 2 : Le nom n\u0026#39;est pas g√©n√©rique. Note over Receiver, DNS: 3. V√©rification Directe (Forward A) Receiver-\u0026gt;\u0026gt;DNS: \u0026#34;Quelle est l\u0026#39;IP de mail.a.com ?\u0026#34; (Query A) DNS--\u0026gt;\u0026gt;Receiver: \u0026#34;C\u0026#39;est 1.2.3.4\u0026#34; Note over Receiver: 4. Validation FCrDNS (IP \u0026lt;-\u0026gt; DNS) Note right of Receiver: IP r√©elle == IP du DNS ?\u0026lt;br/\u0026gt;OK, l\u0026#39;IP correspond bien au nom DNS. Note over Receiver: 5. Validation de Coh√©rence (HELO Check) Note right of Receiver: Nom annonc√© (EHLO) == Nom FCrDNS ?\u0026lt;br/\u0026gt;\u0026#34;mail.a.com\u0026#34; == \u0026#34;mail.a.com\u0026#34; alt Validation Totale R√©ussie Receiver-\u0026gt;\u0026gt;Sender: 250 OK (Accepte la transaction) else √âchec Coh√©rence ou DNS Note over Receiver, Sender: D√âCISION SELON POLITIQUE %% Zone Rouge (Transparence 0.15) rect rgba(255, 0, 0, 0.15) Receiver--\u0026gt;\u0026gt;Sender: Cas Strict : 4xx/5xx Reject end %% Zone Or/Jaune (Transparence 0.15) rect rgba(255, 165, 0, 0.15) Receiver--\u0026gt;\u0026gt;Sender: Cas Tol√©rant : Accept√© (mais Spam Score++) end endLa protection contre les Spammeurs \u0026ldquo;Amateurs\u0026rdquo;# Le principal avantage du FCrDNS est qu\u0026rsquo;il bloque l\u0026rsquo;envoi de masse depuis des infrastructures non professionnelles (PC infect√©s qui forment des botnets).\nHistoriquement, les spammeurs utilisaient souvent des serveurs mal configur√©s ou des machines infect√©es sur des r√©seaux d\u0026rsquo;acc√®s grand public (DSL, c√¢ble) qui ne disposaient pas de PTR configur√©s ou qui avaient des PTR g√©n√©riques. Un PTR valide √©tait la preuve qu\u0026rsquo;un administrateur responsable contr√¥lait l\u0026rsquo;adresse IP.\nLe FCrDNS est la premi√®re barri√®re. C\u0026rsquo;est un test binaire : si le PTR est absent ou g√©n√©rique, la r√©putation est mauvaise.\nLimite# Le FCrDNS valide le serveur (la machine), mais pas l\u0026rsquo;identit√© de l\u0026rsquo;exp√©diteur. Il ne garantit pas que le serveur a le droit d\u0026rsquo;envoyer des mails pour le domaine a.com, ni que le message n\u0026rsquo;a pas √©t√© modifi√©. FCrDNS est uniquement une mesure de r√©putation d\u0026rsquo;infrastructure afin de lutter contre les botnets.\nC\u0026rsquo;est ce qui a rendu obligatoire l\u0026rsquo;adoption de protocoles compl√©mentaires :\nSender Policy Framework (SPF) DomainKeys Identified Mail (DKIM) Domain-based Message Authentication (DMARC) "},{"id":3,"href":"/antispoofing-e-mail/03-spf-sender-policy-framework/","title":"De SMTP √† DMARC (3/8) : SPF (Sender Policy Framework)","section":"Antispoofing e-mail","content":"Principe de fonctionnement# Standardis√© en 2006 (RFC 4408), mis √† jour en 2014 (RFC 7208).\nLe SPF agit comme un annuaire de confiance. Le propri√©taire du domaine a.com publie dans son DNS (enregistrement TXT) la liste des IPs autoris√©es √† envoyer des e-mails en son nom.\nLorsqu\u0026rsquo;un e-mail arrive, le serveur de r√©ception v√©rifie l\u0026rsquo;IP d\u0026rsquo;envoi par rapport √† cette liste. Attention : Le SPF v√©rifie le domaine indiqu√© dans le Return-Path (l\u0026rsquo;enveloppe), et non le From (l\u0026rsquo;en-t√™te visible).\nsequenceDiagram autonumber %% --- Acteurs --- participant Sender as Serveur Exp√©diteur\u0026lt;br/\u0026gt;(IP: 1.2.3.4) participant Receiver as Serveur Destinataire\u0026lt;br/\u0026gt;(b.com) participant DNS as DNS\u0026lt;br/\u0026gt;(Zone a.com) %% --- √âtape 1 : Le transport --- Note over Sender, Receiver: 1. L\u0026#39;ENVELOPPE (SMTP) Sender-\u0026gt;\u0026gt;Receiver: Connexion TCP (Source IP: 1.2.3.4) Sender-\u0026gt;\u0026gt;Receiver: EHLO mail.serveur.com Sender-\u0026gt;\u0026gt;Receiver: MAIL FROM: \u0026lt;alice@a.com\u0026gt; %% --- Le d√©clencheur --- Note right of Receiver: Le serveur B note deux choses :\u0026lt;br/\u0026gt;1. L\u0026#39;IP qui frappe √† la porte : 1.2.3.4\u0026lt;br/\u0026gt;2. Le domaine pr√©tendu : a.com %% --- √âtape 2 : La consultation --- Note over Receiver, DNS: 2. L\u0026#39;INTERROGATION (Lookup) Receiver-\u0026gt;\u0026gt;DNS: Donne-moi l\u0026#39;enregistrement TXT (SPF) de \u0026#34;a.com\u0026#34; DNS--\u0026gt;\u0026gt;Receiver: \u0026#34;v=spf1 ip4:1.2.3.4 ip4:203.0.113.5 -all\u0026#34; %% --- √âtape 3 : La d√©cision --- Note over Receiver: 3. LA COMPARAISON Note right of Receiver: Le serveur B regarde sa liste :\u0026lt;br/\u0026gt;\u0026#34;L\u0026#39;IP 1.2.3.4 est-elle dans la liste que le DNS m\u0026#39;a donn√©e ?\u0026#34; alt L\u0026#39;IP est dans la liste Receiver-\u0026gt;\u0026gt;Sender: SPF Result: PASS\u0026lt;br/\u0026gt;(Continue la transaction...) else L\u0026#39;IP n\u0026#39;est pas dans la liste Receiver--\u0026gt;\u0026gt;Sender: SPF Result: FAIL\u0026lt;br/\u0026gt;(550 Message rejected) endLimites : La d√©l√©gation, Forwarding et int√©grit√© du message# Le SPF pr√©sente deux faiblesses majeures :\nD√©l√©gation sophistiqu√©e des ESP et probl√®me d\u0026rsquo;alignement : Si a.com utilise un ESP comme Mailjet, l\u0026rsquo;e-mail aura un Return-Path chez mailjet.com (pour g√©rer les rebonds) et un From chez a.com. Le SPF validera l\u0026rsquo;IP de Mailjet pour le domaine mailjet.com. Le SPF passe, mais il ne valide pas que l\u0026rsquo;exp√©diteur visible (a.com) est l√©gitime, ce qui laisse parfois place √† une falsification visuelle pour l\u0026rsquo;utilisateur. Nous verrons plus tard que DMARC vient pallier ce probl√®me. Le Forwarding : Si un e-mail est transf√©r√© automatiquement d\u0026rsquo;une bo√Æte A vers une bo√Æte B, l\u0026rsquo;IP d\u0026rsquo;envoi change (c\u0026rsquo;est celle du serveur de transfert), mais le Return-Path reste souvent celui de l\u0026rsquo;exp√©diteur original. L\u0026rsquo;IP du serveur de transfert n\u0026rsquo;√©tant pas dans la liste SPF de l\u0026rsquo;exp√©diteur, le SPF √©choue. L\u0026rsquo;int√©grit√© de message : Si SPF permet de v√©rifier qu\u0026rsquo;un mail a √©t√© l√©gitimement √©mis par a.com, il ne permet pas de valider que le message n\u0026rsquo;a pas √©t√© modifi√© lors de son transfert. Il faudra s\u0026rsquo;appuyer sur DKIM pour confirmer que le message n\u0026rsquo;a pas √©t√© alt√©r√© comme nous le verrons plus tard. La contrainte technique : La limite des 10 requ√™tes DNS : Pour √©viter que la v√©rification SPF ne serve de vecteur d\u0026rsquo;attaque par d√©ni de service (DoS) sur les infrastructures DNS, l\u0026rsquo;√©valuation d\u0026rsquo;un enregistrement SPF ne doit pas g√©n√©rer plus de 10 requ√™tes DNS suppl√©mentaires. D√©l√©gation sophistiqu√©e des ESP et probl√®me d\u0026rsquo;alignement# Le probl√®me se pose lorsque le propri√©taire d\u0026rsquo;un domaine (a.com) d√©l√®gue l\u0026rsquo;envoi de ses e-mails √† un Fournisseur de Services de Messagerie (ESP) comme Mailjet.\nLe M√©canisme Classique du SPF# Le SPF fonctionne en v√©rifiant si l\u0026rsquo;adresse IP d\u0026rsquo;envoi est autoris√©e par le domaine du Return-Path (le domaine de l\u0026rsquo;enveloppe) :\nExp√©diteur : alice@a.com Adresse IP : L\u0026rsquo;IP appartient √† Mailjet. Return-Path : Dans une configuration standard, l\u0026rsquo;ESP utilise son propre domaine pour g√©rer les rebonds (ex : bounce-id@mailjet.com). Le serveur r√©cepteur (b.com) effectue la v√©rification SPF :\nIl regarde le Return-Path : mailjet.com. Il consulte le record SPF de mailjet.com. Il constate que l\u0026rsquo;IP est bien dans la liste des IPs autoris√©es par mailjet.com. R√©sultat SPF : PASS. L\u0026rsquo;√âchec de l\u0026rsquo;Authentification de l\u0026rsquo;Utilisateur Final# Le probl√®me est que le SPF a valid√© la l√©gitimit√© de Mailjet, mais n\u0026rsquo;a rien prouv√© concernant la l√©gitimit√© de l\u0026rsquo;exp√©diteur : a.com :\nLe serveur r√©cepteur sait que Mailjet a envoy√© l\u0026rsquo;e-mail. Le serveur r√©cepteur ne v√©rifie pas que l\u0026rsquo;utilisateur qui a configur√© le From en alice@a.com est effectivement l√©gitime pour √©mettre un e-mail de a.com. Le Contournement du Probl√®me# C\u0026rsquo;est l√† que le SPF seul montre ses limites en mati√®re d\u0026rsquo;anti-usurpation (anti-spoofing) :\nUne personne mal intentionn√©e (un spammeur) pourrait :\nUtiliser l\u0026rsquo;infrastructure de Mailjet avec son propre compte ou un compte pirat√©. R√©gler le champ From √† president@whitehouse.gov. Le Return-Path restera bounce-id@bnc3.mailjet.com. V√©rification SPF : L\u0026rsquo;e-mail passe, car l\u0026rsquo;IP est autoris√©e par le domaine mailjet.com. Conclusion : Le SPF seul permet de valider le chemin d\u0026rsquo;envoi (l\u0026rsquo;ESP), mais ne garantit pas que le domaine visible (From) a √©t√© utilis√© l√©gitimement, car il y a un d√©salignement entre le domaine du From (whitehouse.gov) et le domaine v√©rifi√© par SPF (mailjet.com).\nLe SPF est donc aveugle √† cette d√©l√©gation sophistiqu√©e : il voit juste que le Return-Path est bien g√©r√©.\nC\u0026rsquo;est pr√©cis√©ment pour rem√©dier √† ce manque d\u0026rsquo;alignement du domaine visible (From) que le protocole DMARC a √©t√© cr√©√©. DMARC exige que le domaine du Return-Path (v√©rifi√© par SPF) soit align√© avec le domaine du From (ou que le domaine de la signature DKIM soit align√© avec le domaine du From comme nous le verrons plus tard). Le SPF ne r√©siste pas au forward d\u0026rsquo;e-mail# Le transfert (forward) d\u0026rsquo;e-mail est le talon d\u0026rsquo;Achille du SPF.\nImaginons qu\u0026rsquo;Alice (a.com) envoie un e-mail √† Bob (b.com).\nBob a configur√© une redirection automatique de sa bo√Æte pro vers sa bo√Æte perso (c.com).\nLe serveur de Bob re√ßoit l\u0026rsquo;e-mail (SPF valide : l\u0026rsquo;IP d\u0026rsquo;Alice est OK).\nLe serveur de Bob transf√®re l\u0026rsquo;e-mail vers c.com.\nLe probl√®me : Du point de vue du serveur c.com, l\u0026rsquo;e-mail provient de l\u0026rsquo;adresse IP du serveur de Bob (b.com), mais l\u0026rsquo;adresse d\u0026rsquo;exp√©diteur (Return-Path) indique toujours a.com.\nLe serveur c.com va v√©rifier le SPF : \u0026ldquo;Est-ce que l\u0026rsquo;IP de Bob (b.com) est autoris√©e √† envoyer des e-mails pour le domaine a.com ?\u0026rdquo; La r√©ponse est NON. Le SPF √©choue. C\u0026rsquo;est pourquoi le SPF seul ne permet pas, dans le cas du forward d\u0026rsquo;e-mail, de garantir la l√©gitimit√© de l\u0026rsquo;e-mail d\u0026rsquo;Alice a.com aux yeux du serveur d\u0026rsquo;e-mail de c.com.\nDans ce cas, il faudra utiliser un autre protocole DKIM pour valider l\u0026rsquo;authenticit√© de l\u0026rsquo;e-mail.\nLa contrainte technique : La limite des 10 requ√™tes DNS# Pour √©viter que la v√©rification SPF ne serve de vecteur d\u0026rsquo;attaque par d√©ni de service (DoS) sur les infrastructures DNS, la RFC 7208 impose une limite stricte : l\u0026rsquo;√©valuation d\u0026rsquo;un enregistrement SPF ne doit pas g√©n√©rer plus de 10 requ√™tes DNS suppl√©mentaires.\nChaque m√©canisme qui demande au serveur de r√©ception d\u0026rsquo;interroger le DNS compte pour 1 : cela concerne les include, a, mx, ptr et exists. Attention, cela est r√©cursif : si vous faites un include:spf.protection.outlook.com et que Microsoft fait lui-m√™me un include dans son record, cela compte pour 2 requ√™tes. En revanche, les m√©canismes ip4 et ip6 sont \u0026ldquo;gratuits\u0026rdquo; car ils ne n√©cessitent pas d\u0026rsquo;interrogation DNS.\nLe danger : Si vous cumulez trop de prestataires (ex: Google + Salesforce + Mailjet + Zendesk), vous d√©passerez cette limite. Le r√©sultat sera un `PermError imm√©diat, provoquant le rejet de vos e-mails ou leur classement en spam, m√™me si l\u0026rsquo;IP exp√©ditrice √©tait techniquement autoris√©e.\n"},{"id":4,"href":"/antispoofing-e-mail/04-dkim-domainkeys-identified-mail/","title":"De SMTP √† DMARC (4/8) : DKIM (DomainKeys Identified Mail)","section":"Antispoofing e-mail","content":"Principe de fonctionnement : Le scell√© de preuves de la police# Standardis√© en 2007 (RFC 4871), mis √† jour en 2011 (RFC 6376).\nSi le SPF prot√®ge l\u0026rsquo;enveloppe (le serveur d\u0026rsquo;envoi), DKIM (DomainKeys Identified Mail) prot√®ge le message lui-m√™me. C\u0026rsquo;est l\u0026rsquo;√©quivalent num√©rique d\u0026rsquo;un scell√© de preuves de la police :\nTransparence (Pas de confidentialit√©) : N\u0026rsquo;importe qui peut regarder √† travers le scell√© et voir exactement ce qu\u0026rsquo;il contient (le texte de l\u0026rsquo;e-mail). Scell√© inviolable (Int√©grit√©) : Si quelqu\u0026rsquo;un essaie d\u0026rsquo;ouvrir le sac pour remplacer l\u0026rsquo;objet √† l\u0026rsquo;int√©rieur ou changer un mot sur un document, il doit d√©chirer le plastique. Le destinataire verra imm√©diatement que le sac a √©t√© forc√© (i.e. la signature DKIM √©choue). √âtiquette officielle (Authentification) : Le sac porte le logo du commissariat ou de la banque (le domaine √©metteur). DKIM utilise la cryptographie asym√©trique (cl√© priv√©e / cl√© publique) :\nSignature (Serveur d\u0026rsquo;envoi) : Le serveur sortant (ou l\u0026rsquo;ESP) choisit certains champs de l\u0026rsquo;en-t√™te et le corps du message. La liste des champs d\u0026rsquo;en-t√™te sign√©s se trouve dans le tag h= du champ d\u0026rsquo;en-t√™te DKIM-Signature de l\u0026rsquo;e-mail. La norme recommande de signer au minimum les champs d\u0026rsquo;en-t√™te: h=From:To:Subject:Date:Message-ID. Le corps du message est d\u0026rsquo;abord hach√© et celui-ci est mis dans le tag bh= : on dit que le champ d\u0026rsquo;en-t√™te DKIM-Signature est pr√©par√© √† la signature. Enfin les champs d\u0026rsquo;en-t√™te renseign√©s dans le tag h= ainsi que le champ d\u0026rsquo;en-t√™te DKIM-Signature sont sign√©s avec une cl√© priv√©e puis mis dans le tag b=. V√©rification (Serveur de r√©ception) : Le serveur destinataire lit l\u0026rsquo;en-t√™te DKIM. Il y trouve le \u0026ldquo;s√©lecteur\u0026rdquo; (selector) et le domaine signataire (d=a.com). Il va alors interroger le DNS de ce domaine pour r√©cup√©rer la cl√© publique. Validation : Avec la cl√© publique, il d√©chiffre la signature et recalcule le hash du message re√ßu. Si les deux correspondent, cela prouve deux choses : Authenticit√© : Le propri√©taire du domaine d√©tient bien la cl√© priv√©e. Int√©grit√© : Le message n\u0026rsquo;a pas √©t√© modifi√© d\u0026rsquo;un seul octet en cours de route. graph TD %% --- Styles --- classDef private fill:#ffcdd2,stroke:#c62828,stroke-width:2px,color:#000 classDef public fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px,color:#000 classDef email fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000 classDef action fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000 %% --- BLOC 1 : EXP√âDITEUR --- %% J\u0026#39;ai remplac√© \u0026#34;1. \u0026#34; par \u0026#34;ETAPE 1 -\u0026#34; pour √©viter le bug de liste subgraph SENDER [\u0026#34;1 - EXP√âDITEUR (a.com)\u0026#34;] PrivKey[\u0026#34;üîë Cl√© Priv√©e\u0026lt;br/\u0026gt;(Secret)\u0026#34;]:::private Email_Original[\u0026#34;üìÑ E-mail Original\u0026#34;]:::email Sign_Process[\u0026#34;‚öôÔ∏è Signature\u0026lt;br/\u0026gt;(Hachage + Chiffrement)\u0026#34;]:::action %% Flux PrivKey --\u0026gt; Sign_Process Email_Original --\u0026gt; Sign_Process end %% Transition Sign_Process --\u0026gt;|Envoi via Internet| Email_In %% --- BLOC 2 : DESTINATAIRE --- subgraph RECEIVER [\u0026#34;2 - DESTINATAIRE (b.com)\u0026#34;] Email_In[\u0026#34;üì® E-mail Re√ßu\u0026lt;br/\u0026gt;(Avec DKIM-Signature)\u0026#34;]:::email Read_Header[\u0026#34;üîç Lecture du S√©lecteur\u0026lt;br/\u0026gt;(s=..., d=a.com)\u0026#34;]:::action end %% Transition Read_Header --\u0026gt;|Requ√™te Publique| DNSRecord %% --- BLOC 3 : DNS --- subgraph DNSZONE [\u0026#34;3 - DNS PUBLIC (a.com)\u0026#34;] DNSRecord[\u0026#34;üìñ Record TXT\u0026lt;br/\u0026gt;(Contient la üóùÔ∏è Cl√© Publique)\u0026#34;]:::public end %% Retour DNSRecord --\u0026gt;|Fournit la cl√©| Verify_Process %% --- BLOC 4 : VERDICT --- subgraph VERDICT [\u0026#34;4 - VALIDATION\u0026#34;] Verify_Process[\u0026#34;üßÆ V√©rification\u0026lt;br/\u0026gt;(Recalcul du Hash)\u0026#34;]:::action Result{\u0026#34;Correspondance ?\u0026#34;} Verify_Process --\u0026gt; Result Result --\u0026gt;|OUI| Pass[\u0026#34;‚úÖ DKIM PASS\u0026#34;]:::public Result --\u0026gt;|NON| Fail[\u0026#34;‚ùå DKIM FAIL\u0026#34;]:::private endR√©sistance au Forwarding# Contrairement au SPF, DKIM r√©siste au transfert d\u0026rsquo;e-mail (forwarding) : En effet, la signature est attach√©e au corps du message et aux en-t√™tes, tant que le serveur de transfert ne modifie pas le contenu (ce qu\u0026rsquo;il ne doit pas faire), la signature reste valide, m√™me si l\u0026rsquo;adresse IP d\u0026rsquo;envoi change.\nLimites# DKIM ne garantie pas l\u0026rsquo;authenticit√© de l\u0026rsquo;√©metteur visible dans le champ d\u0026rsquo;en-t√™te From# Comme pour SPF, un attaquant peut signer un e-mail avec son propre domaine (attaquant.com) tout en affichant banque.com dans le champ From. DKIM dira \u0026ldquo;Signature Valide pour attaquant.com\u0026rdquo;, mais l\u0026rsquo;utilisateur verra \u0026ldquo;Banque\u0026rdquo; dans son client e-mail. Encore une fois, il y a encore un manque d\u0026rsquo;alignement qui sera palli√© par DMARC.\nL\u0026rsquo;attaque par Replay et l\u0026rsquo;att√©nuation# Une limite de DKIM est l\u0026rsquo;attaque par rejeu (Replay Attack). Un pirate peut intercepter un e-mail l√©gitime (sign√© DKIM) envoy√© par votre PDG, et le renvoyer tel quel √† des millions de personnes. Comme le message n\u0026rsquo;est pas modifi√©, la signature DKIM reste valide math√©matiquement. Bien que DMARC aide, la vraie parade se situe dans la configuration avanc√©e de DKIM :\nL\u0026rsquo;expiration (x=) : Il est possible d\u0026rsquo;ajouter un tag `x= dans la signature pour dire \u0026ldquo;Cette signature n\u0026rsquo;est valable que 24h\u0026rdquo;. Le timestamp (t=) : Indique l\u0026rsquo;heure de signature. Les serveurs modernes peuvent refuser des signatures trop anciennes. "},{"id":5,"href":"/antispoofing-e-mail/05-dmarc-domain-based-message-authentication-reporting-and-conformance/","title":"De SMTP √† DMARC (5/8) : DMARC (Domain-based Message Authentication)","section":"Antispoofing e-mail","content":"Le Chef d\u0026rsquo;Orchestre# Publi√© en 2015 (RFC 7489).\nJusqu\u0026rsquo;ici, nous avons vu que :\nSPF valide l\u0026rsquo;IP mais v√©rifie le Return-Path, pas le From. DKIM valide le contenu et v√©rifie le domaine de la signature (d=). Il ne v√©rifie pas le From. DMARC (Domain-based Message Authentication, Reporting, and Conformance) ne propose pas une nouvelle m√©thode d\u0026rsquo;authentification technique, mais une couche de politique qui s\u0026rsquo;appuie sur SPF et DKIM pour r√©soudre le probl√®me de l\u0026rsquo;alignement.\nDMARC utilise les r√©sultats de SPF et DKIM et ajoute une r√®gle simple : Pour que l\u0026rsquo;e-mail soit valide, le domaine visible par l\u0026rsquo;utilisateur (le From) doit √™tre \u0026ldquo;align√©\u0026rdquo; (identique) avec au moins l\u0026rsquo;un des deux protocoles authentifi√©s (soit le domaine du SPF, soit le domaine du DKIM).\nLes 3 piliers de DMARC# L\u0026rsquo;Alignement (Identifier Alignment) : DMARC v√©rifie si le domaine du From correspond soit au domaine valid√© par SPF (celui du Return-Path), soit au domaine de la signature DKIM (le tag¬†d= du champ d\u0026rsquo;en-t√™te DKIM-Signature). On appelle \u0026ldquo;alignement\u0026rdquo; cette correspondance. C\u0026rsquo;est ce qui emp√™che un spammeur d\u0026rsquo;utiliser par exemple l\u0026rsquo;infrastructure de Mailjet (SPF valide pour Mailjet) pour envoyer un e-mail avec From: president@whitehouse.gov. DMARC √©choue car whitehouse.gov n\u0026rsquo;est pas align√© avec mailjet.com. C\u0026rsquo;est ce m√©canisme qui emp√™che enfin le spoofing d\u0026rsquo;adresse visible. La Politique (Policy) : DMARC permet au propri√©taire du domaine de dire au r√©cepteur quoi faire si la validation √©choue. C\u0026rsquo;est d√©fini par la balise p= dans le DNS : p=none : Observation uniquement. \u0026ldquo;Dis-moi juste qui √©choue, mais laisse passer l\u0026rsquo;e-mail.\u0026rdquo; (Id√©al pour commencer et auditer). p=quarantine : Mise en doute. \u0026ldquo;Mets les e-mails qui √©chouent dans le dossier Spam du destinataire.\u0026rdquo; p=reject : Protection maximale. \u0026ldquo;Rejette purement et simplement les e-mails qui √©chouent. Ils n\u0026rsquo;arriveront jamais.\u0026rdquo; Le Reporting (RUA/RUF) : C\u0026rsquo;est la boucle de r√©troaction. Les serveurs de r√©ception (Gmail, Yahoo, etc.) envoient des rapports XML quotidiens √† l\u0026rsquo;adresse d√©finie dans le record DMARC. Cela permet √† l\u0026rsquo;administrateur de savoir exactement qui envoie des e-mails en son nom (l√©gitimement ou non) et de corriger sa configuration avant de passer en mode reject. graph TD %% --- Styles --- classDef input fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000 classDef check fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000 classDef pass fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px,color:#000 classDef fail fill:#ffcdd2,stroke:#c62828,stroke-width:2px,color:#000 classDef policy fill:#e1bee7,stroke:#8e24aa,stroke-width:2px,color:#000 %% --- ETAPE 1 : LES PREUVES --- subgraph INPUTS [\u0026#34;1 - LES PREUVES DISPONIBLES\u0026#34;] HeaderFrom[\u0026#34;üë§ Header FROM\u0026lt;br/\u0026gt;(Ce que voit l\u0026#39;utilisateur)\u0026#34;]:::input SPF_Res[\u0026#34;üöö R√©sultat SPF\u0026lt;br/\u0026gt;(Domaine Return-Path)\u0026#34;]:::input DKIM_Res[\u0026#34;üõ°Ô∏è R√©sultat DKIM\u0026lt;br/\u0026gt;(Domaine de signature d=)\u0026#34;]:::input end %% --- ETAPE 2 : LE TEST D\u0026#39;ALIGNEMENT --- subgraph ALIGNMENT [\u0026#34;2 - VERIFICATION D\u0026#39;ALIGNEMENT\u0026#34;] %% Liens invisibles pour forcer la structure HeaderFrom --\u0026gt; CompareSPF HeaderFrom --\u0026gt; CompareDKIM CompareSPF{\u0026#34;Le FROM matche\u0026lt;br/\u0026gt;le SPF ?\u0026#34;}:::check CompareDKIM{\u0026#34;Le FROM matche\u0026lt;br/\u0026gt;le DKIM ?\u0026#34;}:::check SPF_Res --\u0026gt; CompareSPF DKIM_Res --\u0026gt; CompareDKIM end %% --- ETAPE 3 : LE VERDICT DMARC --- subgraph VERDICT [\u0026#34;3 - VERDICT GLOBAL\u0026#34;] FinalDecision{\u0026#34;Au moins UN\u0026lt;br/\u0026gt;match ?\u0026#34;}:::check CompareSPF --\u0026gt; FinalDecision CompareDKIM --\u0026gt; FinalDecision FinalDecision -- OUI --\u0026gt; DMARC_OK[\u0026#34;‚úÖ DMARC PASS\u0026lt;br/\u0026gt;(Inbox)\u0026#34;]:::pass FinalDecision -- NON --\u0026gt; DMARC_FAIL[\u0026#34;‚ùå DMARC FAIL\u0026lt;br/\u0026gt;(Non align√©)\u0026#34;]:::fail end %% --- ETAPE 4 : APPLICATION POLITIQUE --- subgraph ENFORCEMENT [\u0026#34;4 - POLITIQUE\u0026#34;] PolicyCheck[\u0026#34;üëÆ Lecture de p=...\u0026#34;]:::policy DMARC_FAIL --\u0026gt; PolicyCheck PolicyCheck -- \u0026#34;p=none\u0026#34; --\u0026gt; ActNone[\u0026#34;Laissez passer\u0026lt;br/\u0026gt;(Monitoring)\u0026#34;]:::policy PolicyCheck -- \u0026#34;p=quarantine\u0026#34; --\u0026gt; ActSpam[\u0026#34;Dossier Spam\u0026#34;]:::policy PolicyCheck -- \u0026#34;p=reject\u0026#34; --\u0026gt; ActReject[\u0026#34;üö´ Rejet Total\u0026#34;]:::fail endPour aller plus loin# Note sur le transfert et les Mailing Lists (SRS \u0026amp; ARC)# Vous avez peut-√™tre constat√© que certains transferts d\u0026rsquo;e-mails fonctionnent malgr√© les limitations de SPF. C\u0026rsquo;est gr√¢ce √† deux m√©canismes g√©r√©s par les serveurs interm√©diaires (sur lesquels vous n\u0026rsquo;avez pas la main) :\nSRS (Sender Rewriting Scheme) : Le serveur de relais r√©√©crit l\u0026rsquo;enveloppe (Return-Path) pour que le SPF passe avec sa propre IP. Cela corrige le SPF mais casse l\u0026rsquo;alignement DMARC. ARC (Authenticated Received Chain) : Le serveur de relais signe l\u0026rsquo;√©tat de l\u0026rsquo;authentification (SPF/DKIM) avant de modifier le message. Cela permet au destinataire final (comme Gmail) de valider l\u0026rsquo;e-mail via une cha√Æne de confiance, m√™me si SPF et DKIM √©chouent techniquement √† l\u0026rsquo;arriv√©e. "},{"id":6,"href":"/antispoofing-e-mail/06-bimi-brand-indicators-for-message-identification-analyse-des-limites/","title":"De SMTP √† DMARC (6/8) : BIMI et analyse des limites","section":"Antispoofing e-mail","content":"Dans l\u0026rsquo;√©cosyst√®me de la s√©curit√© des e-mails, BIMI (Brand Indicators for Message Identification) est souvent pr√©sent√© comme la prochaine √©tape logique apr√®s la mise en conformit√© DMARC. L\u0026rsquo;objectif est de permettre l\u0026rsquo;affichage d\u0026rsquo;un logo certifi√© dans les clients de messagerie pour renforcer la confiance visuelle.\nCependant, une analyse technique approfondie r√©v√®le que ce protocole est plus complexe qu\u0026rsquo;il n\u0026rsquo;y para√Æt. Contrairement √† SPF ou DKIM qui sont purement d√©claratifs, BIMI s\u0026rsquo;appuie g√©n√©ralement sur un tiers de confiance via un certificat num√©rique appel√© VMC (Verified Mark Certificate). Si ce m√©canisme fonctionne dans des environnements int√©gr√©s (comme les webmails de Google ou Yahoo), il se heurte √† des obstacles structurels majeurs d√®s qu\u0026rsquo;il est confront√© √† l\u0026rsquo;architecture ouverte et standardis√©e de l\u0026rsquo;e-mail.\nVoici une analyse des trois freins principaux qui rendent l\u0026rsquo;adoption de BIMI complexe, voire risqu√©e, pour l\u0026rsquo;Internet ouvert.\nLe risque de s√©curit√© : La vuln√©rabilit√© de l\u0026rsquo;architecture d√©coupl√©e# Le principal obstacle technique √† une impl√©mentation g√©n√©ralis√©e de BIMI r√©side dans la s√©paration des r√¥les entre le serveur et le client.\nDans la sp√©cification BIMI, la charge de la v√©rification incombe au MTA (Mail Transfer Agent - le serveur de r√©ception). C\u0026rsquo;est lui qui doit valider le certificat VMC, v√©rifier l\u0026rsquo;alignement DMARC et, en cas de succ√®s, ajouter ou r√©g√©n√©rer des en-t√™tes sp√©cifiques (ex: BIMI-Location ou Authentication-Results) pour indiquer au client que le logo peut √™tre affich√©.\nLe probl√®me de la transmission de confiance via IMAP : Cette architecture suppose une cha√Æne de confiance ininterrompue. Or, pour les clients de messagerie universels (MUA) comme Thunderbird ou Outlook (en mode IMAP), cette cha√Æne est bris√©e. Le protocole IMAP, dans sa standardisation actuelle, ne permet pas au client de savoir avec certitude qui a √©crit l\u0026rsquo;en-t√™te BIMI :\nEst-ce le serveur (MTA) qui a l√©gitimement valid√© le message et ins√©r√© l\u0026rsquo;en-t√™te ? Ou est-ce l\u0026rsquo;exp√©diteur malveillant qui a inject√© un faux en-t√™te BIMI-Location avant l\u0026rsquo;envoi ? Sans une extension stricte du protocole IMAP permettant au serveur de signer ses r√©sultats d\u0026rsquo;authentification ou de garantir au client qu\u0026rsquo;il a \u0026ldquo;nettoy√©\u0026rdquo; les en-t√™tes entrants, le client mail se trouve dans l\u0026rsquo;incapacit√© de distinguer un vrai logo d\u0026rsquo;une tentative de phishing sophistiqu√©e.\nC\u0026rsquo;est cette raison technique pr√©cise qui pousse les d√©veloppeurs de Mozilla Thunderbird √† refuser l\u0026rsquo;impl√©mentation de BIMI en l\u0026rsquo;√©tat, la jugeant non s√©curis√©e pour une architecture ouverte. De son c√¥t√©, Microsoft a contourn√© le probl√®me pour Outlook en ignorant BIMI au profit d\u0026rsquo;une solution propri√©taire centralis√©e, ne faisant pas confiance aux en-t√™tes transitant par le mail.\nPour que cela soit s√©curis√©, la sp√©cification exige que le MTA nettoie (strip) tous les en-t√™tes BIMI entrants avant de faire ses propres v√©rifications et d\u0026rsquo;ajouter son propre en-t√™te.\nSc√©nario d√©taill√©e# Le r√¥le du serveur (MTA) dans la sp√©cification BIMI : Dans la sp√©cification BIMI, c\u0026rsquo;est le serveur de r√©ception qui fait le gros du travail. Il doit : 1.1 V√©rifier DMARC. 1.2 R√©cup√©rer le certificat VMC (Verified Mark Certificate). 1.3 Valider la cha√Æne de certification du logo. 1.4 Une fois tout cela valid√©, il ajoute un en-t√™te sp√©cifique au courriel (ex: Authentication-Results ou BIMI-Location) pour dire au client : \u0026ldquo;C\u0026rsquo;est bon, j\u0026rsquo;ai v√©rifi√©, tu peux afficher ce logo\u0026rdquo;. Le sc√©nario d\u0026rsquo;attaque : Imaginez qu\u0026rsquo;un attaquant vous envoie un e-mail de phishing pr√©tendant venir de votre banque. 2.1 L\u0026rsquo;attaque : L\u0026rsquo;attaquant injecte manuellement l\u0026rsquo;en-t√™te suivant dans son e-mail frauduleux avant de l\u0026rsquo;envoyer : Authentication-Results: bimi=pass; header.d=mabanque.com; 2.2 Le serveur interm√©diaire (Non-BIMI) : Votre e-mail arrive sur un serveur mail classique (ex: un vieux serveur Postfix d\u0026rsquo;entreprise, ou un FAI qui n\u0026rsquo;a pas encore impl√©ment√© BIMI). Ce serveur ne conna√Æt pas BIMI. Il v√©rifie peut-√™tre SPF/DKIM, mais il ignore l\u0026rsquo;en-t√™te BIMI falsifi√©. Surtout, il ne le supprime pas, car il ne sait pas que cet en-t√™te est sensible. Il transmet le mail tel quel √† Thunderbird. 2.3 La r√©ception sur Thunderbird : Thunderbird rel√®ve le courrier via IMAP. Il voit l\u0026rsquo;en-t√™te Authentication-Results: bimi=pass. Le dilemme de Thunderbird (et de tous les MUA universels) Thunderbird se connecte √† n\u0026rsquo;importe quel serveur IMAP du monde. Lorsqu\u0026rsquo;il voit cet en-t√™te \u0026ldquo;bimi=pass\u0026rdquo;, il a deux possibilit√©s : 3.1 Possibilit√© A : Le serveur est compatible BIMI. Il a re√ßu le mail, a supprim√© les faux en-t√™tes, a fait la v√©rification, et a appos√© ce sceau de confiance. (L√©gitime) 3.2 Possibilit√© B : Le serveur est \u0026ldquo;b√™te\u0026rdquo; (non-BIMI). Il a juste laiss√© passer l\u0026rsquo;en-t√™te falsifi√© par l\u0026rsquo;attaquant. (Phishing) Thunderbird n\u0026rsquo;a aucun moyen technique de savoir s\u0026rsquo;il est dans la situation A ou B. Il n\u0026rsquo;existe pas (actuellement) de commande IMAP standardis√©e (ex: CAPABILITY BIMI) qui permettrait au serveur de dire √† Thunderbird : \u0026ldquo;Hey, je g√®re le BIMI, tu peux faire confiance √† mes en-t√™tes, j\u0026rsquo;ai nettoy√© les faux\u0026rdquo;. Pourquoi Gmail ou Yahoo n\u0026rsquo;ont pas ce probl√®me ? L\u0026rsquo;application Gmail sur Android ou l\u0026rsquo;interface web de Yahoo Mail savent pertinemment qu\u0026rsquo;elles parlent aux serveurs de Google ou Yahoo. Le code de l\u0026rsquo;interface Gmail \u0026ldquo;sait\u0026rdquo; que le serveur Gmail nettoie les en-t√™tes. La confiance est implicite car le client et le serveur appartiennent √† la m√™me entit√©. Thunderbird, en tant que client universel, ne peut pas accorder cette confiance aveugle √† tous les serveurs IMAP de la plan√®te. Si Thunderbird impl√©mentait BIMI aujourd\u0026rsquo;hui en se basant simplement sur la pr√©sence des en-t√™tes, un attaquant pourrait afficher le logo officiel de \u0026ldquo;PayPal\u0026rdquo; ou \u0026ldquo;Cr√©dit Agricole\u0026rdquo; sur un mail de phishing simplement en ajoutant une ligne de texte dans l\u0026rsquo;en-t√™te de son mail, pour peu que votre serveur de mail ne filtre pas activement ces balises.\nPour que Thunderbird puisse l\u0026rsquo;impl√©menter de fa√ßon s√ªre, il faudrait soit :\nQue Thunderbird fasse lui-m√™me toute la validation BIMI (ce qui est lourd : r√©cup√©ration des certificats VMC, validation crypto, etc., c√¥t√© client). Qu\u0026rsquo;une extension du protocole IMAP soit cr√©√©e pour certifier que le serveur en amont est \u0026ldquo;BIMI-Aware\u0026rdquo;. Une barri√®re √©conomique √† l\u0026rsquo;entr√©e (VMC)# Contrairement aux protocoles fondamentaux de l\u0026rsquo;e-mail (SMTP, SPF, DKIM, DMARC) qui sont bas√©s sur la comp√©tence technique et accessibles gratuitement √† quiconque poss√®de un nom de domaine, BIMI introduit une barri√®re financi√®re via le VMC (Verified Mark Certificate).\nPour √™tre conforme √† la sp√©cification (telle qu\u0026rsquo;exig√©e par Google ou Apple), le domaine doit acqu√©rir un certificat aupr√®s d\u0026rsquo;une autorit√© de certification tierce. Ce co√ªt, avoisinant les 1 200 ‚Ç¨ √† 1 500 ‚Ç¨ par an, est certes abordable pour une PME, une ETI ou une grande entreprise consid√©rant cela comme une d√©pense marketing.\nCependant, ce mod√®le √©conomique exclut de facto une part importante des acteurs de l\u0026rsquo;Internet :\nLes TPE et micro-entreprises pour qui ce co√ªt est prohibitif. Le secteur associatif et non-lucratif (hors grandes ONG). Les particuliers, les d√©veloppeurs ind√©pendants et les communaut√©s du logiciel libre. En liant la s√©curit√© visuelle √† la capacit√© de paiement et √† la possession d\u0026rsquo;une marque d√©pos√©e, BIMI s\u0026rsquo;√©loigne de la philosophie de neutralit√© du net o√π la l√©gitimit√© technique d\u0026rsquo;un exp√©diteur (prouv√©e par DMARC) devrait suffire, ind√©pendamment de sa puissance financi√®re.\nConclusion# BIMI soul√®ve une question int√©ressante sur l\u0026rsquo;√©volution des standards Internet. Si l\u0026rsquo;intention de fournir une validation visuelle est louable, son impl√©mentation actuelle pose un probl√®me de s√©curit√© pour les clients mails universels et introduit une discrimination √©conomique.\nPour l\u0026rsquo;heure, la recommandation technique la plus robuste reste l\u0026rsquo;application stricte des standards ouverts : SPF, DKIM et DMARC (p=reject ou p=quarantine sur 100% des mails). Ces protocoles garantissent la s√©curit√© et la d√©livrabilit√© du message pour tous, sans d√©pendre d\u0026rsquo;une cha√Æne de certification payante ni d\u0026rsquo;une architecture client-serveur propri√©taire.\n"},{"id":7,"href":"/antispoofing-e-mail/07-parked-domain-locking/","title":"De SMTP √† DMARC (7/8) : Parked Domain Locking","section":"Antispoofing e-mail","content":"Un domaine qui n\u0026rsquo;envoie aucun e-mail doit √©galement configurer SPF, DKIM et DMARC afin de d√©clarer : \u0026ldquo;Ce domaine n\u0026rsquo;envoie jamais d\u0026rsquo;e-mail. Si vous en recevez un, jetez-le imm√©diatement.\u0026rdquo;. C\u0026rsquo;est indispensable pour prot√©ger contre l\u0026rsquo;usurpation : les pirates pourraient utiliser des domaines \u0026ldquo;dormants\u0026rdquo; ou des variations de votre domaine (typosquatting) pour envoyer du phishing, car personne ne les surveille.\nVoici la configuration DNS qu\u0026rsquo;il faut appliquer :\nType H√¥te / Nom Valeur R√¥le TXT @ v=spf1 -all SPF (D√©clare que personne n\u0026rsquo;est autoris√© √† envoyer des e-mails au nom du domaine) TXT _dmarc v=DMARC1; p=reject; sp=reject; adkim=s; aspf=s; DMARC (Demande au destinataire de rejeter tout e-mail qui d√©clarerait provenir du domaine) TXT *._domainkey v=DKIM1; p= DKIM (Invalide toutes les cl√©s) MX @ . (Priorit√© 0) MX (ce domaine ne re√ßoit pas d\u0026rsquo;e-mail RFC 7505 (Null MX)) "},{"id":8,"href":"/antispoofing-e-mail/08-synthese-et-conclusion/","title":"De SMTP √† DMARC (8/8) : Synth√®se et conclusion","section":"Antispoofing e-mail","content":"Synth√®se et conclusion# M√©canisme Date / RFC Image R√¥le Limites Cl√©s FCrDNS ~1990s Le contr√¥le technique du camion¬†qui transporte les enveloppes. Valide que le propri√©taire de l\u0026rsquo;infrastructure (celui qui contr√¥le l\u0026rsquo;IP / L3) et le propri√©taire de l\u0026rsquo;identit√© (celui qui contr√¥le le Domaine / L7) sont d\u0026rsquo;accord. V√©rifie que le PTR de l\u0026rsquo;√©metteur ne soit pas g√©n√©rique. Ne prouve pas que l\u0026rsquo;IP source est l√©gitime pour envoyer un e-mail au nom du domaine exp√©diteur ni que le message n\u0026rsquo;a pas √©t√© falsifi√©. SPF 2006 (RFC 4408) 2014 (RFC 7208) Valide que le camion est autoris√© √† transporter le courrier de l\u0026rsquo;√©metteur. Autorise une liste d\u0026rsquo;IPs √† envoyer des e-mails au nom du domaine indiqu√© dans le Return-Path. Vuln√©rable aux redirections. Pas d\u0026rsquo;alignement avec le champ visible (From). DKIM 2007 (RFC 4871) 2011 (RFC 6376) Sceau de cire num√©rique Scell√© de preuves de la police Garantit l\u0026rsquo;int√©grit√© et l\u0026rsquo;authenticit√© du message par l\u0026rsquo;ajout d\u0026rsquo;une signature cryptographique au message. (d= dans l\u0026rsquo;en-t√™te DKIM). Pas d\u0026rsquo;alignement obligatoire avec From. Ne garantit pas la confidentialit√© (l\u0026rsquo;e-mail reste lisible). DMARC 2015 (RFC 7489) Le Majordome (Chef du protocole). V√©rifie que l\u0026rsquo;en-t√™te de la lettre est align√© soit avec l\u0026rsquo;adresse au dos de l\u0026rsquo;enveloppe (SPF) soit avec le sceau de cire num√©rique (Signature DKIM) V√©rifie l\u0026rsquo;alignement du domaine v√©rifi√© par SPF ou DKIM avec le domaine visible (From). D√©finit la politique de gestion des √©checs (none, quarantine, reject). Permet le reporting (RUA/RUF) Fonctionne uniquement si SPF/DKIM sont impl√©ment√©s et que la politique est active. La s√©curisation des e-mails n\u0026rsquo;est pas l\u0026rsquo;affaire d\u0026rsquo;un seul protocole, mais repose sur une strat√©gie de d√©fense en profondeur. La combinaison des protocoles FCrDNS, SPF, DKIM et DMARC permet de cr√©er une cha√Æne de confiance robuste, rendant l\u0026rsquo;usurpation d\u0026rsquo;identit√© technique (spoofing) quasi impossible, √† condition que la cha√Æne ne soit pas bris√©e.\nPour garantir cette s√©curit√©, deux conditions sont imp√©ratives :\nUne configuration stricte c√¥t√© √©metteur : Les administrateurs de domaines doivent viser l\u0026rsquo;excellence : SPF verrouill√© avec -all (Hard Fail). DMARC en politique p=reject (Rejet pur et simple des √©checs). Une validation rigoureuse c√¥t√© r√©cepteur : Les serveurs de r√©ception doivent effectuer les contr√¥les cryptographiques et DNS en temps r√©el. C\u0026rsquo;est aujourd\u0026rsquo;hui le standard chez les g√©ants du secteur (Gmail, Microsoft, Yahoo, Proton, etc.). Si ces protocoles ferment la porte √† l\u0026rsquo;usurpation technique (envoyer un e-mail en tant que president@whitehouse.gov), ils ne peuvent pas emp√™cher l\u0026rsquo;ing√©nierie sociale. Une fois la barri√®re technique lev√©e, la vigilance de l\u0026rsquo;utilisateur reste le dernier rempart contre les attaques qui contournent les protocoles :\nLe Typosquatting (Homoglyphes) : L\u0026rsquo;attaquant ach√®te un domaine l√©gitime qui ressemble visuellement √† la cible (ex : bance-postale.fr au lieu de banque-postale.fr). DMARC validera cet e-mail car il provient l√©gitimement du domaine de l\u0026rsquo;attaquant. Le Display Name Spoofing : L\u0026rsquo;attaquant utilise une adresse g√©n√©rique (ex : jean.pirate@gmail.com) mais modifie le nom d\u0026rsquo;affichage pour qu\u0026rsquo;il apparaisse comme \u0026ldquo;Support Technique\u0026rdquo; ou \u0026ldquo;Votre PDG\u0026rdquo;. En r√©sum√©, si DMARC garantit que l\u0026rsquo;exp√©diteur est bien celui qu\u0026rsquo;il pr√©tend √™tre techniquement, il ne garantit pas que ses intentions sont bienveillantes. L\u0026rsquo;√©ducation des utilisateurs √† la v√©rification syst√©matique du domaine dans le champ From demeure indispensable et compl√©mentaire des mesures techniques.\nLe diagramme suivant synth√©tise la pile de s√©curit√© d\u0026rsquo;e-mail :\ngraph TD %% --- Styles --- classDef network fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000 classDef auth fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000 classDef policy fill:#c8e6c9,stroke:#1b5e20,stroke-width:2px,color:#000 classDef human fill:#f8bbd0,stroke:#c2185b,stroke-width:2px,color:#000 classDef outcome fill:#e0e0e0,stroke:#757575,stroke-width:1px,color:#000 %% --- Entr√©e --- Mail[\u0026#34;üìß E-mail Entrant\u0026#34;] %% --- Couches --- subgraph \u0026#34;Couche 1 : R√©seau\u0026#34; L1[\u0026#34;FCrDNS\u0026lt;br/\u0026gt;Validation IP/Domaine\u0026#34;]:::network end subgraph \u0026#34;Couche 2 : Auth Technique\u0026#34; L2_SPF[\u0026#34;SPF\u0026lt;br/\u0026gt;Autorisation IP\u0026#34;]:::auth L2_DKIM[\u0026#34;DKIM\u0026lt;br/\u0026gt;Signature \u0026amp; Int√©grit√©\u0026#34;]:::auth end subgraph \u0026#34;Couche 3 : Politique\u0026#34; L3[\u0026#34;DMARC\u0026lt;br/\u0026gt;Alignement \u0026amp; R√®gles\u0026#34;]:::policy end subgraph \u0026#34;Couche 4 : Humain\u0026#34; L4[\u0026#34;Utilisateur\u0026lt;br/\u0026gt;Vigilance Typosquatting\u0026#34;]:::human end %% --- Sorties --- Inbox[\u0026#34;üì• Bo√Æte de R√©ception\u0026#34;]:::outcome Spam[\u0026#34;üö´ Spam / Rejet\u0026#34;]:::outcome %% --- Flux --- Mail --\u0026gt; L1 %% Du r√©seau vers l\u0026#39;auth L1 --\u0026gt; L2_SPF Mail --\u0026gt; L2_DKIM %% De l\u0026#39;auth vers DMARC L2_SPF --\u0026gt; L3 L2_DKIM --\u0026gt; L3 L1 -.-\u0026gt;|Info PTR| L3 %% D√©cision DMARC L3 --\u0026gt;|Succ√®s| L4 L3 --\u0026gt;|√âchec| Spam %% D√©cision Humaine L4 --\u0026gt;|L√©gitime| Inbox L4 --\u0026gt;|Phishing d√©tect√©| SpamQuelques URL utiles :\nhttps://postmaster.google.com https://www.mail-tester.com https://dmarc.postmarkapp.com "},{"id":9,"href":"/recalbox/pc-worms/","title":"PC Worms","section":"Recalboxes","content":"Installation de Worms (PC DOS) sur Recalbox avec pistes CD Audio# Ce guide explique comment extraire et installer la version CD-ROM originale de Worms vendu par Sold out sur Recalbox, en pr√©servant les pistes audio (musique d\u0026rsquo;ambiance) qui sont souvent perdues lors d\u0026rsquo;une copie standard.\n1. Pr√©requis (Sous Fedora Linux 43)# Il est n√©cessaire d\u0026rsquo;installer les outils en ligne de commande pour manipuler les CD mixtes (Donn√©es + Audio).\nsudo dnf install cdrdao gcdmaster2. Extraction du CD (Image binaire)# Le CD de Worms est un disque \u0026ldquo;mixte\u0026rdquo; : la piste 1 contient les donn√©es du jeu, et les pistes suivantes contiennent la musique. Pour que la musique soit lue correctement sous Linux/Recalbox, il faut inverser l\u0026rsquo;ordre des bits (Byte Swap).\nIns√©rez le CD (ne pas monter le disque) et lancez cette commande pour cr√©er une image brute :\ncdrdao read-cd --read-raw --datafile Worms.bin --device /dev/sr0 --driver generic-mmc-raw:0x20000 Worms.tocExplication des options :\n--read-raw : Copie le disque bit par bit (utile pour les protections). generic-mmc-raw:0x20000 : L\u0026rsquo;option cruciale. Le suffixe :0x20000 force l\u0026rsquo;inversion des bits audio (Byte Swap). Cela corrige le probl√®me de lecture \u0026ldquo;Little Endian\u0026rdquo; vs \u0026ldquo;Big Endian\u0026rdquo; qui transformerait sinon la musique en bruit blanc (gr√©sillements). 3. Conversion du fichier de structure (.cue)# Recalbox utilise le format .cue. Il faut convertir le fichier .toc g√©n√©r√© par cdrdao.\ntoc2cue Worms.toc Worms.cueV√©rification du fichier .cue# Ouvrez le fichier Worms.cue avec un √©diteur de texte. V√©rifiez la premi√®re ligne :\nElle doit contenir un chemin relatif : FILE \u0026quot;Worms.bin\u0026quot; BINARY Si elle contient un chemin absolu (ex: /home/user/...), supprimez le chemin pour ne garder que le nom du fichier. 4. Installation sur la Recalbox# Connectez-vous √† votre Recalbox via le r√©seau. Allez dans le dossier share/roms/dos/. Cr√©ez un r√©pertoire nomm√© Worms.pc. Copiez-y les fichiers Worms.bin et Worms.cue. 5. Configuration et Lancement# Cr√©ez un fichier dosbox.bat √† l\u0026rsquo;int√©rieur du dossier Worms.pc.\nPhase A : Premi√®re installation (Setup)# Au premier lancement, il faut installer le jeu sur le disque dur virtuel pour configurer le son. Utilisez ce contenu temporaire pour dosbox.bat :\n@echo off imgmount D \u0026#34;Worms.cue\u0026#34; -t iso D: SETUP.EXELancez le jeu, faites l\u0026rsquo;installation (Sound Blaster 16), puis quittez.\nPhase B : Script de jeu d√©finitif# Une fois install√©, modifiez le fichier dosbox.bat avec le script final :\n@echo off imgmount D \u0026#34;Worms.cue\u0026#34; -t iso C: cd WORMS WORMS.EXEAstuces# Manette souris - Pas encore test√© : Sur Recalbox (DosBox Pure), vous pouvez activer la souris virtuelle en appuyant sur L3 (clic stick gauche) ou via le menu de configuration (L3+R3 \u0026gt; Controller Mapping). Sauvegardes : Le dossier WORMS cr√©√© lors de l\u0026rsquo;installation contient vos √©quipes et progressions. Il est stock√© directement dans votre dossier Worms.pc. "}]